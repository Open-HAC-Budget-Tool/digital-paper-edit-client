(this["webpackJsonp@pietrop/digital-paper-edit-client"]=this["webpackJsonp@pietrop/digital-paper-edit-client"]||[]).push([[6],{261:function(e,t,a){"use strict";a.r(t);var n=a(79),r=a.n(n),c=a(76),l=a(0),o=a.n(l),i=a(110),s=a.n(i),m=a(252),d=a(247),u=a(253),p=a(244),E=a(248),b=a(250),f=a(259),x=a(254),k=a(256),y=a(249),h=a(217),w=a.n(h),g=a(255),j=a(260),v=a(123),O=a.n(v),T=a(72),S=a(9),C=a(222),D=a(216),_=a(251),N=a(221),A=a(172),I=a.n(A),F=a(174),P=a.n(F),W=a(126),B=a(175),R=a.n(B);var L=function(e){var t=e.handleExport,a=e.optionalBtns,n=Object(l.useState)(null),r=Object(c.a)(n,2),i=r[0],s=r[1],m=function(){s(null)};return o.a.createElement(p.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},o.a.createElement("div",null,o.a.createElement(j.a,{title:"Export options"},o.a.createElement(d.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){s(e.currentTarget)}},o.a.createElement(I.a,{color:"primary"})," ",o.a.createElement(P.a,{color:"primary"}))),o.a.createElement(N.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:m},o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(y.a,{style:{color:"black"}},"Text Export")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"Text (",o.a.createElement("code",null,".txt"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"Text (Speakers)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"Text (Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Text (Speakers & Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,atlasFormat:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Text (Atlas format)")),o.a.createElement(_.a,null),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," ","Word (",o.a.createElement("code",null,".docx"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (Speakers)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (Speakers & Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,inlineTimecodes:!0,hideTitle:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (OHMS)")),o.a.createElement(_.a,null),o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(y.a,{style:{color:"black"}},"Closed Captions Export")),W.a.map((function(e,a){var n=e.type,r=e.label,c=e.ext;return o.a.createElement(f.a,{key:a+r,onClick:function(){t({type:n,ext:c,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},r," (",o.a.createElement("code",null,".",c),")"))})),o.a.createElement(_.a,null),o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(y.a,{style:{color:"black"}},"Developer options")),o.a.createElement(f.a,{onClick:function(){t({type:"json-slate",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"SlateJs (",o.a.createElement("code",null,".json"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"json-digitalpaperedit",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"DPE (",o.a.createElement("code",null,".json"),")")))),o.a.createElement(j.a,{title:" Double click on a word to jump to the corresponding point in the media"},o.a.createElement(d.a,{color:"primary"},o.a.createElement(R.a,{color:"primary"}))),a)},U=a(78),J=a(176),M=a(224),z=a(177),V=a(178),H=(a(179),a(95)),X=a(219),q=a(94),G=a(218),K=[.2,.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,3,3.5],Q=o.a.createRef();O()((function(e){e.play()}),1500);function Y(e){var t=this,a=Object(l.useState)(0),n=Object(c.a)(a,2),i=n[0],h=n[1],v=Object(l.useState)(0),O=Object(c.a)(v,2),_=O[0],N=O[1],A=Object(l.useState)(1),I=Object(c.a)(A,2),F=I[0],P=I[1],W=Object(l.useMemo)((function(){return Object(C.d)(Object(D.a)(Object(T.i)()))}),[]),B=Object(l.useState)([]),R=Object(c.a)(B,2),Y=R[0],Z=R[1],$="boolean"!==typeof e.showSpeakers||e.showSpeakers,ee="boolean"!==typeof e.showTimecodes||e.showTimecodes,te=Object(l.useState)($),ae=Object(c.a)(te,2),ne=ae[0],re=(ae[1],Object(l.useState)(ee)),ce=Object(c.a)(re,2),le=ce[0],oe=(ce[1],Object(l.useState)([])),ie=Object(c.a)(oe,2),se=ie[0],me=ie[1],de=Object(l.useState)(!1),ue=Object(c.a)(de,2),pe=ue[0],Ee=ue[1],be=Object(l.useState)(null),fe=Object(c.a)(be,2),xe=(fe[0],fe[1],Object(l.useState)(!1)),ke=Object(c.a)(xe,2),ye=(ke[0],ke[1],Object(l.useState)(!1)),he=Object(c.a)(ye,2),we=he[0],ge=he[1],je=Object(l.useState)(!1),ve=Object(c.a)(je,2),Oe=ve[0],Te=ve[1],Se=Object(l.useState)(!0),Ce=Object(c.a)(Se,2),De=Ce[0],_e=Ce[1],Ne=new URLSearchParams(Object(S.l)().search);Object(l.useEffect)((function(){document.body.style.cursor=we?"wait":"default"}),[we]),Object(l.useEffect)((function(){if(e.transcriptData){var t=Object(M.a)(e.transcriptData);Z(t)}}),[e.transcriptData]),Object(l.useEffect)((function(){var e=Object(V.a)("speaker")(Y);me(e)}),[Y]),Object(l.useEffect)((function(){return Q&&Q.current&&(Q.current.addEventListener("timeupdate",Ie),Ne.get("ts")&&(Q.current.currentTime=Ne.get("ts"))),function(){Q.current.removeEventListener("timeupdate",Ie)}}),[]),Object(l.useEffect)((function(){}),[i]);var Ae=function(){return e.title?e.title:s.a.basename(e.mediaUrl).trim()},Ie=function(e){console.log("handle time updated",e.target.currentTime),h(e.target.currentTime),N(Q.current.duration)},Fe=Object(l.useCallback)((function(e){switch(e.element.type){case"timedText":return o.a.createElement(Be,e);default:return o.a.createElement(Re,e)}}),[]),Pe=Object(l.useCallback)((function(e){var t=e.attributes,a=e.children;e.leaf;return o.a.createElement("span",Object.assign({onDoubleClick:Le,className:"timecode text","data-start":a.props.parent.start,"data-previous-timings":a.props.parent.previousTimings},t),a)}),[]),We=function(e){C.b.findPath(W,e),e.speaker},Be=function(e){var a=12,n=12;return ne||le?ne&&!le?(a=9,n=9):!ne&&le?(a=9,n=10):ne&&le&&(a=6,n=7):(a=12,n=12),o.a.createElement(p.a,Object.assign({container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},e.attributes),le&&o.a.createElement(p.a,{item:!0,contentEditable:!1,xs:4,sm:2,md:4,lg:2,xl:2,className:"p-t-2 text-truncate"},o.a.createElement("code",{contentEditable:!1,style:{cursor:"pointer"},className:"timecode text-muted unselectable",onClick:Le,onDoubleClick:Le,title:e.element.startTimecode,"data-start":e.element.start},e.element.startTimecode)),ne&&o.a.createElement(p.a,{item:!0,contentEditable:!1,xs:8,sm:10,md:8,lg:3,xl:3,className:"p-t-2 text-truncate"},o.a.createElement(b.a,{noWrap:!0,contentEditable:!1,className:"text-truncate text-muted unselectable",style:{cursor:"pointer",width:"100%",textTransform:"uppercase"},title:e.element.speaker,onClick:We.bind(t,e.element)},e.element.speaker)),o.a.createElement(p.a,{item:!0,xs:12,sm:12,md:12,lg:a,xl:n,className:"p-b-1 mx-auto"},e.children))},Re=function(e){return o.a.createElement("p",e.attributes,e.children)},Le=function(t){if(t.target.classList.contains("timecode")){var a=t.target.dataset.start;Q&&Q.current&&(Q.current.currentTime=parseFloat(a),Q.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"timecode",timeInSeconds:Q.current.currentTime}))}else if(t.target.dataset.slateString&&t.target.parentNode.dataset.start){var n=G.a.getSelectionNodes(W,W.selection).startWord;if(Q&&Q.current&&n&&n.start)Q.current.currentTime=parseFloat(n.start),Q.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"word",timeInSeconds:Q.current.currentTime});else{var r=parseFloat(t.target.parentNode.dataset.start);Q&&Q.current&&r&&(Q.current.currentTime=parseFloat(r),Q.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",origin:"paragraph-fallback",timeInSeconds:Q.current.currentTime}))}}},Ue=function(){var e,t,a,n=arguments;return r.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(e=n.length>0&&void 0!==n[0]&&n[0],Oe||e){c.next=3;break}return c.abrupt("return",Y);case 3:return c.next=5,r.a.awrap(Object(H.b)(Y,e));case 5:if(t=c.sent,Z(t),Te(!1),!e){c.next=11;break}return a=Object(z.a)(t),c.abrupt("return",a);case 11:return c.abrupt("return",t);case 12:case"end":return c.stop()}}))};return o.a.createElement("div",{style:{paddingTop:"1em"}},o.a.createElement(m.a,null),o.a.createElement(u.a,null,o.a.createElement(E.a,{elevation:3}),o.a.createElement("style",{scoped:!0},'/* Next words */\n             .timecode[data-previous-timings*="'.concat(Object(q.a)(i),"\"]{\n                  color:  #9E9E9E;\n              }\n              // NOTE: The CSS is here, coz if you put it as a separate index.css the current webpack does not bundle it with the component\n              /* TODO: Temporary, need to scope this to the component in a sensible way */\n              .editor-wrapper-container {\n                font-family: Roboto, sans-serif;\n              }\n              .editor-wrapper-container {\n                padding: 8px 16px;\n                height: 90vh;\n                overflow: auto;\n              }\n              /* https://developer.mozilla.org/en-US/docs/Web/CSS/user-select\n              TODO: only working in Chrome, not working in Firefox, and Safari - OSX\n              if selecting text, not showing selection\n              Commented out because it means cannot select speakers and timecode anymore\n              which is the intended default behavior but needs to come with export\n              functionality to export as plain text, word etc.. otherwise user won't be able\n              to get text out of component with timecodes and speaker names in the interim */\n              .unselectable {\n                -moz-user-select: none;\n                -webkit-user-select: none;\n                -ms-user-select: none;\n                user-select: none;\n              }\n              .timecode:hover {\n                text-decoration: underline;\n              }\n              .timecode.text:hover {\n                text-decoration: none;\n              }\n          ")),e.showTitle&&o.a.createElement(j.a,{title:e.title},o.a.createElement(b.a,{variant:"h5",noWrap:!0},e.title)),o.a.createElement(p.a,{container:!0,direction:"row",justify:"space-around",alignItems:"flex-start",spacing:2},o.a.createElement(p.a,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4},o.a.createElement(p.a,{container:!0,direction:"column",justify:"space-between",alignItems:"flex-start"},o.a.createElement(p.a,{item:!0,style:{backgroundColor:"black"}},o.a.createElement("video",{ref:Q,src:e.mediaUrl,width:"100%",height:"auto",controls:!0,playsInline:!0})),o.a.createElement(p.a,{item:!0},o.a.createElement(p.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",spacing:1},o.a.createElement(p.a,{item:!0},o.a.createElement("p",null,o.a.createElement("code",{style:{color:"grey"}},Object(U.a)(i)),o.a.createElement("span",{style:{color:"grey"}}," "," | "),o.a.createElement("code",{style:{color:"grey"}},_?"".concat(Object(U.a)(_)):"00:00:00"))),o.a.createElement(p.a,{item:!0},o.a.createElement(j.a,{title:"Seek back by ".concat(10," seconds")},o.a.createElement(d.a,{color:"primary",onClick:function(){if(Q&&Q.current){var t=Q.current.currentTime-10;Q.current.currentTime=t,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_seek_back",{fn:"handleSeekBack",newCurrentTimeInSeconds:t,seekBackValue:10})}},block:"true"},o.a.createElement(w.a,{color:"primary"})))),o.a.createElement(p.a,{item:!0},o.a.createElement(x.a,null,o.a.createElement(k.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:F,onChange:function(t){var a=F,n=t.target.value,r=parseFloat(n);Q&&Q.current&&(Q.current.playbackRate=r,P(r),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_set_playback_rate",{fn:"handleSetPlaybackRate",previousPlaybackRate:a,newPlaybackRate:r}))}},K.map((function(e,t){return o.a.createElement(f.a,{key:t+e,value:e}," ","x ",e)}))))))),o.a.createElement(p.a,{item:!0},o.a.createElement(y.a,{color:"inherit",onClick:function(){Ee(!pe)}},o.a.createElement(b.a,{variant:"subtitle2",gutterBottom:!0},"Speakers")),o.a.createElement(g.a,{in:pe},se.map((function(e,t){return o.a.createElement(b.a,{variant:"body2",gutterBottom:!0,key:t+e,className:"text-truncate",title:e.toUpperCase()},e)})))),o.a.createElement(p.a,{item:!0},e.children))),o.a.createElement(p.a,{item:!0,xs:12,sm:7,md:7,lg:7,xl:7},0!==Y.length?o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{elevation:3},o.a.createElement("section",{className:"editor-wrapper-container"},o.a.createElement(C.c,{editor:W,value:Y,onChange:function(t){return e.handleAutoSaveChanges&&(e.handleAutoSaveChanges(t),_e(!0)),Z(t)}},o.a.createElement(C.a,{readOnly:"boolean"===typeof e.isEditable&&!e.isEditable,renderElement:Fe,renderLeaf:Pe}))))):o.a.createElement("section",{className:"text-center"},o.a.createElement("i",{className:"text-center"},"Loading..."))),o.a.createElement(p.a,{item:!0,xs:12,sm:1,md:1,lg:1,xl:1},o.a.createElement(L,{handleExport:function(t){var a,n,c,l,o,i,s,m,d,u;return r.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(a=t.type,n=t.ext,c=t.speakers,l=t.timecodes,o=t.inlineTimecodes,i=t.hideTitle,s=t.atlasFormat,m=t.isDownload,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_export",{fn:"handleExport",type:a,ext:n,speakers:c,timecodes:l,inlineTimecodes:o,hideTitle:i,atlasFormat:s,isDownload:m}),p.prev=2,ge(!0),d=Y,!l){p.next=9;break}return p.next=8,r.a.awrap(Ue());case 8:d=p.sent;case 9:if(!o){p.next=13;break}return p.next=12,r.a.awrap(Ue(o));case 12:d=p.sent;case 13:if(!Oe||"json-slate"!==a){p.next=17;break}return p.next=16,r.a.awrap(Ue());case 16:d=p.sent;case 17:if(!Oe||"json-digitalpaperedit"!==a){p.next=21;break}return p.next=20,r.a.awrap(Ue());case 20:d=p.sent;case 21:if(!Oe||!Object(X.b)(a)){p.next=25;break}return p.next=24,r.a.awrap(Ue());case 24:d=p.sent;case 25:return u=Object(X.a)({slateValue:d,type:a,transcriptTitle:Ae(),speakers:c,timecodes:l,inlineTimecodes:o,hideTitle:i,atlasFormat:s}),"json"===n&&(u=JSON.stringify(u,null,2)),"docx"!==n&&m&&Object(J.a)(u,"".concat(Ae(),".").concat(n)),p.abrupt("return",u);case 29:return p.prev=29,ge(!1),p.finish(29);case 32:case"end":return p.stop()}}),null,null,[[2,,29,32]])},isProcessing:we,isContentModified:Oe,isContentSaved:De,setIsProcessing:ge,optionalBtns:e.optionalBtns})))))}t.default=Y;Y.defaultProps={showTitle:!1,showTimecodes:!0,showSpeakers:!0,autoSaveContentType:"digitalpaperedit",isEditable:!0}}}]);
//# sourceMappingURL=6.116d8281.chunk.js.map