(this["webpackJsonp@pietrop/digital-paper-edit-client"]=this["webpackJsonp@pietrop/digital-paper-edit-client"]||[]).push([[6],{261:function(e,t,a){"use strict";a.r(t);var n=a(79),r=a.n(n),c=a(76),l=a(0),o=a.n(l),i=a(111),s=a.n(i),m=a(254),d=a(249),u=a(255),p=a(246),E=a(250),b=a(252),f=a(263),x=a(256),y=a(225),k=a(218),h=a(258),w=a(251),g=a(217),j=a.n(g),v=a(257),O=a(262),T=a(125),S=a.n(T),C=(a(128),a(72)),D=a(9),_=a(224),N=a(216),A=a(253),I=a(222),F=a(173),P=a.n(F),L=a(175),R=a.n(L),W=a(129),B=a(176),U=a.n(B);var z=function(e){var t=e.handleExport,a=e.optionalBtns,n=Object(l.useState)(null),r=Object(c.a)(n,2),i=r[0],s=r[1],m=function(){s(null)};return o.a.createElement(p.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},o.a.createElement("div",null,o.a.createElement(O.a,{title:"Export options"},o.a.createElement(d.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){s(e.currentTarget)}},o.a.createElement(P.a,{color:"primary"})," ",o.a.createElement(R.a,{color:"primary"}))),o.a.createElement(I.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:m},o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(w.a,{style:{color:"black"}},"Text Export")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"},"Text (",o.a.createElement("code",null,".txt"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"},"Text (Speakers)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"},"Text (Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"}," Text (Speakers & Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,atlasFormat:!0,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"}," Text (Atlas format)")),o.a.createElement(A.a,null),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"}," ","Word (",o.a.createElement("code",null,".docx"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"}," Word (Speakers)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"}," Word (Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"}," Word (Speakers & Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,inlineTimecodes:!0,hideTitle:!0}),m()}},o.a.createElement(w.a,{color:"primary"}," Word (OHMS)")),o.a.createElement(A.a,null),o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(w.a,{style:{color:"black"}},"Closed Captions Export")),W.a.map((function(e,a){var n=e.type,r=e.label,c=e.ext;return o.a.createElement(f.a,{key:a+r,onClick:function(){t({type:n,ext:c,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"},r," (",o.a.createElement("code",null,".",c),")"))})),o.a.createElement(A.a,null),o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(w.a,{style:{color:"black"}},"Developer options")),o.a.createElement(f.a,{onClick:function(){t({type:"json-slate",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"},"SlateJs (",o.a.createElement("code",null,".json"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"json-digitalpaperedit",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(w.a,{color:"primary"},"DPE (",o.a.createElement("code",null,".json"),")")))),o.a.createElement(O.a,{title:" Double click on a word to jump to the corresponding point in the media"},o.a.createElement(d.a,{color:"primary"},o.a.createElement(U.a,{color:"primary"}))),a)},J=a(78),M=a(177),G=a(226),V=a(178),H=a(179),X=(a(180),a(95)),q=a(221),K=a(94),Q=a(219),Y=[.2,.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,3,3.5],Z=o.a.createRef();S()((function(e){e.play()}),1500);function $(e){var t=this,a=Object(l.useState)(0),n=Object(c.a)(a,2),i=n[0],g=n[1],T=Object(l.useState)(0),S=Object(c.a)(T,2),A=S[0],I=S[1],F=Object(l.useState)(1),P=Object(c.a)(F,2),L=P[0],R=P[1],W=Object(l.useMemo)((function(){return Object(_.d)(Object(N.a)(Object(C.i)()))}),[]),B=Object(l.useState)([]),U=Object(c.a)(B,2),$=U[0],ee=U[1],te="boolean"!==typeof e.showSpeakers||e.showSpeakers,ae="boolean"!==typeof e.showTimecodes||e.showTimecodes,ne=Object(l.useState)(te),re=Object(c.a)(ne,2),ce=re[0],le=(re[1],Object(l.useState)(ae)),oe=Object(c.a)(le,2),ie=oe[0],se=(oe[1],Object(l.useState)([])),me=Object(c.a)(se,2),de=me[0],ue=me[1],pe=Object(l.useState)(!1),Ee=Object(c.a)(pe,2),be=Ee[0],fe=Ee[1],xe=Object(l.useState)(null),ye=Object(c.a)(xe,2),ke=(ye[0],ye[1],Object(l.useState)(!1)),he=Object(c.a)(ke,2),we=(he[0],he[1],Object(l.useState)(!1)),ge=Object(c.a)(we,2),je=ge[0],ve=ge[1],Oe=Object(l.useState)(!1),Te=Object(c.a)(Oe,2),Se=Te[0],Ce=Te[1],De=Object(l.useState)(!0),_e=Object(c.a)(De,2),Ne=_e[0],Ae=_e[1],Ie=new URLSearchParams(Object(D.l)().search);Object(D.l)();Object(l.useEffect)((function(){document.body.style.cursor=je?"wait":"default"}),[je]),Object(l.useEffect)((function(){if(e.transcriptData){var t=Object(G.a)(e.transcriptData);ee(t)}}),[e.transcriptData]),Object(l.useEffect)((function(){var e=Object(H.a)("speaker")($);ue(e)}),[$]),Object(l.useEffect)((function(){return Z&&Z.current&&(Z.current.addEventListener("timeupdate",Pe),Ie.get("ts")&&(Z.current.currentTime=Ie.get("ts"))),function(){Z.current.removeEventListener("timeupdate",Pe)}}),[]),Object(l.useEffect)((function(){}),[i]);var Fe=function(){return e.title?e.title:s.a.basename(e.mediaUrl).trim()},Pe=function(e){console.log("handle time updated",e.target.currentTime),g(e.target.currentTime),I(Z.current.duration)},Le=Object(l.useCallback)((function(e){switch(e.element.type){case"timedText":return o.a.createElement(Be,e);default:return o.a.createElement(Ue,e)}}),[]),Re=Object(l.useCallback)((function(e){var t=e.attributes,a=e.children;e.leaf;return o.a.createElement("span",Object.assign({onDoubleClick:ze,className:"timecode text","data-start":a.props.parent.start,"data-previous-timings":a.props.parent.previousTimings},t),a)}),[]),We=function(e){_.b.findPath(W,e),e.speaker},Be=function(e){var a=12,n=12;return ce||ie?ce&&!ie?(a=9,n=9):!ce&&ie?(a=9,n=10):ce&&ie&&(a=6,n=7):(a=12,n=12),o.a.createElement(p.a,Object.assign({container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},e.attributes),ie&&o.a.createElement(p.a,{item:!0,contentEditable:!1,xs:4,sm:2,md:4,lg:2,xl:2,className:"p-t-2 text-truncate"},o.a.createElement("code",{contentEditable:!1,style:{cursor:"pointer"},className:"timecode text-muted unselectable",onClick:ze,onDoubleClick:ze,title:e.element.startTimecode,"data-start":e.element.start},e.element.startTimecode)),ce&&o.a.createElement(p.a,{item:!0,contentEditable:!1,xs:8,sm:10,md:8,lg:3,xl:3,className:"p-t-2 text-truncate"},o.a.createElement(b.a,{noWrap:!0,contentEditable:!1,className:"text-truncate text-muted unselectable",style:{cursor:"pointer",width:"100%",textTransform:"uppercase"},title:e.element.speaker,onClick:We.bind(t,e.element)},e.element.speaker)),o.a.createElement(p.a,{item:!0,xs:12,sm:12,md:12,lg:a,xl:n,className:"p-b-1 mx-auto"},e.children))},Ue=function(e){return o.a.createElement("p",e.attributes,e.children)},ze=function(t){if(t.target.classList.contains("timecode")){var a=t.target.dataset.start;Z&&Z.current&&(Z.current.currentTime=parseFloat(a),Z.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"timecode",timeInSeconds:Z.current.currentTime}))}else if(t.target.dataset.slateString&&t.target.parentNode.dataset.start){var n=Q.a.getSelectionNodes(W,W.selection).startWord;if(Z&&Z.current&&n&&n.start)Z.current.currentTime=parseFloat(n.start),Z.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"word",timeInSeconds:Z.current.currentTime});else{var r=parseFloat(t.target.parentNode.dataset.start);Z&&Z.current&&r&&(Z.current.currentTime=parseFloat(r),Z.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",origin:"paragraph-fallback",timeInSeconds:Z.current.currentTime}))}}},Je=function(){var e,t,a,n=arguments;return r.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(e=n.length>0&&void 0!==n[0]&&n[0],Se||e){c.next=3;break}return c.abrupt("return",$);case 3:return c.next=5,r.a.awrap(Object(X.b)($,e));case 5:if(t=c.sent,ee(t),Ce(!1),!e){c.next=11;break}return a=Object(V.a)(t),c.abrupt("return",a);case 11:return c.abrupt("return",t);case 12:case"end":return c.stop()}}))};return o.a.createElement("div",{style:{paddingTop:"1em"}},o.a.createElement(m.a,null),o.a.createElement(u.a,null,o.a.createElement(E.a,{elevation:3}),o.a.createElement("style",{scoped:!0},'/* Next words */\n             .timecode[data-previous-timings*="'.concat(Object(K.a)(i),"\"]{\n                  color:  #9E9E9E;\n              }\n              // NOTE: The CSS is here, coz if you put it as a separate index.css the current webpack does not bundle it with the component\n              /* TODO: Temporary, need to scope this to the component in a sensible way */\n              .editor-wrapper-container {\n                font-family: Roboto, sans-serif;\n              }\n              .editor-wrapper-container {\n                padding: 8px 16px;\n                height: 90vh;\n                overflow: auto;\n              }\n              /* https://developer.mozilla.org/en-US/docs/Web/CSS/user-select\n              TODO: only working in Chrome, not working in Firefox, and Safari - OSX\n              if selecting text, not showing selection\n              Commented out because it means cannot select speakers and timecode anymore\n              which is the intended default behavior but needs to come with export\n              functionality to export as plain text, word etc.. otherwise user won't be able\n              to get text out of component with timecodes and speaker names in the interim */\n              .unselectable {\n                -moz-user-select: none;\n                -webkit-user-select: none;\n                -ms-user-select: none;\n                user-select: none;\n              }\n              .timecode:hover {\n                text-decoration: underline;\n              }\n              .timecode.text:hover {\n                text-decoration: none;\n              }\n          ")),e.showTitle&&o.a.createElement(O.a,{title:e.title},o.a.createElement(b.a,{variant:"h5",noWrap:!0},e.title)),o.a.createElement(p.a,{container:!0,direction:"row",justify:"space-around",alignItems:"flex-start",spacing:2},o.a.createElement(p.a,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4},o.a.createElement(p.a,{container:!0,direction:"column",justify:"space-between",alignItems:"flex-start"},o.a.createElement(p.a,{item:!0,style:{backgroundColor:"black"}},o.a.createElement("video",{ref:Z,src:e.mediaUrl,width:"100%",height:"auto",controls:!0,playsInline:!0})),o.a.createElement(p.a,{item:!0},o.a.createElement(p.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",spacing:1},o.a.createElement(p.a,{item:!0},o.a.createElement("p",null,o.a.createElement("code",{style:{color:"grey"}},Object(J.a)(i)),o.a.createElement("span",{style:{color:"grey"}}," "," | "),o.a.createElement("code",{style:{color:"grey"}},A?"".concat(Object(J.a)(A)):"00:00:00"))),o.a.createElement(p.a,{item:!0},o.a.createElement(O.a,{title:"Seek back by ".concat(10," seconds")},o.a.createElement(d.a,{color:"primary",onClick:function(){if(Z&&Z.current){var t=Z.current.currentTime-10;Z.current.currentTime=t,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_seek_back",{fn:"handleSeekBack",newCurrentTimeInSeconds:t,seekBackValue:10})}},block:"true"},o.a.createElement(j.a,{color:"primary"})))),o.a.createElement(p.a,{item:!0},o.a.createElement(x.a,null,o.a.createElement(h.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:L,onChange:function(t){var a=L,n=t.target.value,r=parseFloat(n);Z&&Z.current&&(Z.current.playbackRate=r,R(r),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_set_playback_rate",{fn:"handleSetPlaybackRate",previousPlaybackRate:a,newPlaybackRate:r}))}},Y.map((function(e,t){return o.a.createElement(f.a,{key:t+e,value:e}," ","x ",e)}))))))),o.a.createElement(p.a,{item:!0,style:{width:"100%"}},o.a.createElement(k.a,{size:"sm",className:"mb-3"},o.a.createElement(k.a.Prepend,null,o.a.createElement(k.a.Text,{id:"inputGroup-sizing-sm"},"Link at time")),o.a.createElement(y.a,{"aria-label":"Share URL @ time","aria-describedby":"inputGroup-sizing-sm",readOnly:!0,value:function(e){var t=new URL(window.location.toString());return t.search="","".concat(t.toString(),"?ts=").concat(e)}(i)}))),o.a.createElement(p.a,{item:!0},o.a.createElement(w.a,{color:"inherit",onClick:function(){fe(!be)}},o.a.createElement(b.a,{variant:"subtitle2",gutterBottom:!0},"Speakers")),o.a.createElement(v.a,{in:be},de.map((function(e,t){return o.a.createElement(b.a,{variant:"body2",gutterBottom:!0,key:t+e,className:"text-truncate",title:e.toUpperCase()},e)})))),o.a.createElement(p.a,{item:!0},e.children))),o.a.createElement(p.a,{item:!0,xs:12,sm:7,md:7,lg:7,xl:7},0!==$.length?o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{elevation:3},o.a.createElement("section",{className:"editor-wrapper-container"},o.a.createElement(_.c,{editor:W,value:$,onChange:function(t){return e.handleAutoSaveChanges&&(e.handleAutoSaveChanges(t),Ae(!0)),ee(t)}},o.a.createElement(_.a,{readOnly:"boolean"===typeof e.isEditable&&!e.isEditable,renderElement:Le,renderLeaf:Re}))))):o.a.createElement("section",{className:"text-center"},o.a.createElement("i",{className:"text-center"},"Loading..."))),o.a.createElement(p.a,{item:!0,xs:12,sm:1,md:1,lg:1,xl:1},o.a.createElement(z,{handleExport:function(t){var a,n,c,l,o,i,s,m,d,u;return r.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(a=t.type,n=t.ext,c=t.speakers,l=t.timecodes,o=t.inlineTimecodes,i=t.hideTitle,s=t.atlasFormat,m=t.isDownload,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_export",{fn:"handleExport",type:a,ext:n,speakers:c,timecodes:l,inlineTimecodes:o,hideTitle:i,atlasFormat:s,isDownload:m}),p.prev=2,ve(!0),d=$,!l){p.next=9;break}return p.next=8,r.a.awrap(Je());case 8:d=p.sent;case 9:if(!o){p.next=13;break}return p.next=12,r.a.awrap(Je(o));case 12:d=p.sent;case 13:if(!Se||"json-slate"!==a){p.next=17;break}return p.next=16,r.a.awrap(Je());case 16:d=p.sent;case 17:if(!Se||"json-digitalpaperedit"!==a){p.next=21;break}return p.next=20,r.a.awrap(Je());case 20:d=p.sent;case 21:if(!Se||!Object(q.b)(a)){p.next=25;break}return p.next=24,r.a.awrap(Je());case 24:d=p.sent;case 25:return u=Object(q.a)({slateValue:d,type:a,transcriptTitle:Fe(),speakers:c,timecodes:l,inlineTimecodes:o,hideTitle:i,atlasFormat:s}),"json"===n&&(u=JSON.stringify(u,null,2)),"docx"!==n&&m&&Object(M.a)(u,"".concat(Fe(),".").concat(n)),p.abrupt("return",u);case 29:return p.prev=29,ve(!1),p.finish(29);case 32:case"end":return p.stop()}}),null,null,[[2,,29,32]])},isProcessing:je,isContentModified:Se,isContentSaved:Ne,setIsProcessing:ve,optionalBtns:e.optionalBtns})))))}t.default=$;$.defaultProps={showTitle:!1,showTimecodes:!0,showSpeakers:!0,autoSaveContentType:"digitalpaperedit",isEditable:!0}}}]);
//# sourceMappingURL=6.059f36e8.chunk.js.map