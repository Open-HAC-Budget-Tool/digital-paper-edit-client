(this["webpackJsonp@pietrop/digital-paper-edit-client"]=this["webpackJsonp@pietrop/digital-paper-edit-client"]||[]).push([[6],{265:function(e,t,a){"use strict";a.r(t);var n=a(79),r=a.n(n),c=a(76),l=a(0),i=a.n(l),o=a(111),s=a.n(o),m=a(255),d=a(250),u=a(256),p=a(247),E=a(251),b=a(253),f=a(263),x=a(257),h=a(226),y=a(219),k=a(259),g=a(252),w=a(218),v=a.n(w),j=a(258),O=a(262),T=a(125),S=a.n(T),C=(a(128),a(72)),D=a(9),_=a(224),N=a(217),A=a(90),P=a(254),I=a(223),F=a(173),L=a.n(F),B=a(175),R=a.n(B),U=a(129),W=a(177),z=a.n(W),J=a(176),M=a.n(J);var G=function(e){var t=e.handleExport,a=e.optionalBtns,n=e.handleSetEditable,r=e.isEditable,o=e.isProcessing,s=Object(l.useState)(null),m=Object(c.a)(s,2),u=m[0],E=m[1],b=function(){E(null)};return i.a.createElement(p.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},i.a.createElement("div",null,i.a.createElement(O.a,{title:"Export options"},i.a.createElement(d.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){E(e.currentTarget)}},i.a.createElement(L.a,{color:"primary"})," ",i.a.createElement(R.a,{color:"primary"}))),i.a.createElement(I.a,{id:"simple-menu",anchorEl:u,keepMounted:!0,open:Boolean(u),onClose:b},i.a.createElement(f.a,{onClick:b,disabled:!0},i.a.createElement(g.a,{style:{color:"black"}},"Text Export")),i.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!1,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"},"Text (",i.a.createElement("code",null,".txt"),")")),i.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!1,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"},"Text (Speakers)")),i.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!0,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"},"Text (Timecodes)")),i.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"}," Text (Speakers & Timecodes)")),i.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,atlasFormat:!0,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"}," Text (Atlas format)")),i.a.createElement(P.a,null),i.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"}," ","Word (",i.a.createElement("code",null,".docx"),")")),i.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!1,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"}," Word (Speakers)")),i.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!0,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"}," Word (Timecodes)")),i.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!0,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"}," Word (Speakers & Timecodes)")),i.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,inlineTimecodes:!0,hideTitle:!0}),b()}},i.a.createElement(g.a,{color:"primary"}," Word (OHMS)")),i.a.createElement(P.a,null),i.a.createElement(f.a,{onClick:b,disabled:!0},i.a.createElement(g.a,{style:{color:"black"}},"Closed Captions Export")),U.a.map((function(e,a){var n=e.type,r=e.label,c=e.ext;return i.a.createElement(f.a,{key:a+r,onClick:function(){t({type:n,ext:c,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"},r," (",i.a.createElement("code",null,".",c),")"))})),i.a.createElement(P.a,null),i.a.createElement(f.a,{onClick:b,disabled:!0},i.a.createElement(g.a,{style:{color:"black"}},"Developer options")),i.a.createElement(f.a,{onClick:function(){t({type:"json-slate",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"},"SlateJs (",i.a.createElement("code",null,".json"),")")),i.a.createElement(f.a,{onClick:function(){t({type:"json-digitalpaperedit",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),b()}},i.a.createElement(g.a,{color:"primary"},"DPE (",i.a.createElement("code",null,".json"),")")))),i.a.createElement(O.a,{title:" Turn ".concat(r?"off":"on"," edit mode.  You can edit before exporting the transcript.")},i.a.createElement(d.a,{disabled:o,onClick:n},i.a.createElement(M.a,Object(A.a)({color:"primary"},"color",r?"secondary":"primary")))),i.a.createElement(O.a,{title:" Double click on a word to jump to the corresponding point in the media"},i.a.createElement(d.a,{color:"primary"},i.a.createElement(z.a,{color:"primary"}))),a)},V=a(78),H=a(178),K=a(227),X=a(179),Y=a(180),q=(a(181),a(96)),Q=a(222),Z=a(95),$=a(220),ee=[.2,.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,3,3.5],te=i.a.createRef();var ae=S()((function(e){e.play()}),1500);function ne(e){var t=this,a=Object(l.useState)(0),n=Object(c.a)(a,2),o=n[0],w=n[1],T=Object(l.useState)(0),S=Object(c.a)(T,2),A=S[0],P=S[1],I=Object(l.useState)(1),F=Object(c.a)(I,2),L=F[0],B=F[1],R=Object(l.useMemo)((function(){return Object(_.d)(Object(N.a)(Object(C.i)()))}),[]),U=Object(l.useState)([]),W=Object(c.a)(U,2),z=W[0],J=W[1],M="boolean"!==typeof e.showSpeakers||e.showSpeakers,ne="boolean"!==typeof e.showTimecodes||e.showTimecodes,re=Object(l.useState)(M),ce=Object(c.a)(re,2),le=ce[0],ie=(ce[1],Object(l.useState)(ne)),oe=Object(c.a)(ie,2),se=oe[0],me=(oe[1],Object(l.useState)([])),de=Object(c.a)(me,2),ue=de[0],pe=de[1],Ee=Object(l.useState)(!1),be=Object(c.a)(Ee,2),fe=be[0],xe=be[1],he=Object(l.useState)(null),ye=Object(c.a)(he,2),ke=(ye[0],ye[1],Object(l.useState)(!1)),ge=Object(c.a)(ke,2),we=ge[0],ve=(ge[1],Object(l.useState)(!1)),je=Object(c.a)(ve,2),Oe=je[0],Te=je[1],Se=Object(l.useState)(!1),Ce=Object(c.a)(Se,2),De=Ce[0],_e=Ce[1],Ne=Object(l.useState)(!0),Ae=Object(c.a)(Ne,2),Pe=Ae[0],Ie=Ae[1],Fe=Object(l.useState)(e.isEditable,[]),Le=Object(c.a)(Fe,2),Be=Le[0],Re=Le[1],Ue=new URLSearchParams(Object(D.l)().search);Object(l.useEffect)((function(){document.body.style.cursor=Oe?"wait":"default"}),[Oe]),Object(l.useEffect)((function(){if(e.transcriptData){var t=Object(K.a)(e.transcriptData);J(t)}}),[e.transcriptData]),Object(l.useEffect)((function(){var e=Object(Y.a)("speaker")(z);pe(e)}),[z]),Object(l.useEffect)((function(){return te&&te.current&&(te.current.addEventListener("timeupdate",ze),Ue.get("ts")&&(te.current.currentTime=Ue.get("ts"))),function(){te.current.removeEventListener("timeupdate",ze)}}),[e.mediaUrl]),Object(l.useEffect)((function(){}),[o]);var We=function(){return e.title?e.title:s.a.basename(e.mediaUrl).trim()},ze=function(e){w(e.target.currentTime),P(te.current.duration)},Je=Object(l.useCallback)((function(e){switch(e.element.type){case"timedText":return i.a.createElement(Ve,e);default:return i.a.createElement(He,e)}}),[]),Me=Object(l.useCallback)((function(e){var t=e.attributes,a=e.children;e.leaf;return i.a.createElement("span",Object.assign({onDoubleClick:Ke,className:"timecode text","data-start":a.props.parent.start,"data-previous-timings":a.props.parent.previousTimings},t),a)}),[]),Ge=function(e){_.b.findPath(R,e),e.speaker},Ve=function(e){var a=12,n=12;return le||se?le&&!se?(a=9,n=9):!le&&se?(a=9,n=10):le&&se&&(a=6,n=7):(a=12,n=12),i.a.createElement(p.a,Object.assign({container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},e.attributes),se&&i.a.createElement(p.a,{item:!0,contentEditable:!1,xs:4,sm:2,md:4,lg:2,xl:2,className:"p-t-2 text-truncate"},i.a.createElement("code",{contentEditable:!1,style:{cursor:"pointer"},className:"timecode text-muted unselectable",onClick:Ke,onDoubleClick:Ke,title:e.element.startTimecode,"data-start":e.element.start},e.element.startTimecode)),le&&i.a.createElement(p.a,{item:!0,contentEditable:!1,xs:8,sm:10,md:8,lg:3,xl:3,className:"p-t-2 text-truncate"},i.a.createElement(b.a,{noWrap:!0,contentEditable:!1,className:"text-truncate text-muted unselectable",style:{cursor:"pointer",width:"100%",textTransform:"uppercase"},title:e.element.speaker,onClick:Ge.bind(t,e.element)},e.element.speaker)),i.a.createElement(p.a,{item:!0,xs:12,sm:12,md:12,lg:a,xl:n,className:"p-b-1 mx-auto"},e.children))},He=function(e){return i.a.createElement("p",e.attributes,e.children)},Ke=function(t){if(t.target.classList.contains("timecode")){var a=t.target.dataset.start;te&&te.current&&(te.current.currentTime=parseFloat(a),te.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"timecode",timeInSeconds:te.current.currentTime}))}else if(t.target.dataset.slateString&&t.target.parentNode.dataset.start){var n=$.a.getSelectionNodes(R,R.selection).startWord;if(te&&te.current&&n&&n.start)te.current.currentTime=parseFloat(n.start),te.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"word",timeInSeconds:te.current.currentTime});else{var r=parseFloat(t.target.parentNode.dataset.start);te&&te.current&&r&&(te.current.currentTime=parseFloat(r),te.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",origin:"paragraph-fallback",timeInSeconds:te.current.currentTime}))}}},Xe=function(){var e,t,a,n=arguments;return r.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(e=n.length>0&&void 0!==n[0]&&n[0],De||e){c.next=3;break}return c.abrupt("return",z);case 3:return c.next=5,r.a.awrap(Object(q.b)(z,e));case 5:if(t=c.sent,J(t),_e(!1),!e){c.next=11;break}return a=Object(X.a)(t),c.abrupt("return",a);case 11:return c.abrupt("return",t);case 12:case"end":return c.stop()}}))};return i.a.createElement("div",{style:{paddingTop:"1em"}},i.a.createElement(m.a,null),i.a.createElement(u.a,null,i.a.createElement(E.a,{elevation:3}),i.a.createElement("style",{scoped:!0},'/* Next words */\n             .timecode[data-previous-timings*="'.concat(Object(Z.a)(o),"\"]{\n                  color:  #9E9E9E;\n              }\n              // NOTE: The CSS is here, coz if you put it as a separate index.css the current webpack does not bundle it with the component\n              /* TODO: Temporary, need to scope this to the component in a sensible way */\n              .editor-wrapper-container {\n                font-family: Roboto, sans-serif;\n              }\n              .editor-wrapper-container {\n                padding: 8px 16px;\n                height: 90vh;\n                overflow: auto;\n              }\n              /* https://developer.mozilla.org/en-US/docs/Web/CSS/user-select\n              TODO: only working in Chrome, not working in Firefox, and Safari - OSX\n              if selecting text, not showing selection\n              Commented out because it means cannot select speakers and timecode anymore\n              which is the intended default behavior but needs to come with export\n              functionality to export as plain text, word etc.. otherwise user won't be able\n              to get text out of component with timecodes and speaker names in the interim */\n              .unselectable {\n                -moz-user-select: none;\n                -webkit-user-select: none;\n                -ms-user-select: none;\n                user-select: none;\n              }\n              .timecode:hover {\n                text-decoration: underline;\n              }\n              .timecode.text:hover {\n                text-decoration: none;\n              }\n          ")),e.showTitle&&i.a.createElement(O.a,{title:e.title},i.a.createElement(b.a,{variant:"h5",noWrap:!0},e.title)),i.a.createElement(p.a,{container:!0,direction:"row",justify:"space-around",alignItems:"flex-start",spacing:2},i.a.createElement(p.a,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4},i.a.createElement(p.a,{container:!0,direction:"column",justify:"space-between",alignItems:"flex-start"},e.mediaUrl&&i.a.createElement(i.a.Fragment,null,i.a.createElement(p.a,{item:!0,style:{backgroundColor:"black"}},i.a.createElement("video",{ref:te,src:e.mediaUrl,width:"100%",height:"auto",controls:!0,playsInline:!0})),i.a.createElement(p.a,{item:!0},i.a.createElement(p.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",spacing:1},i.a.createElement(p.a,{item:!0},i.a.createElement("p",null,i.a.createElement("code",{style:{color:"grey"}},Object(V.a)(o)),i.a.createElement("span",{style:{color:"grey"}}," "," | "),i.a.createElement("code",{style:{color:"grey"}},A?"".concat(Object(V.a)(A)):"00:00:00"))),i.a.createElement(p.a,{item:!0},i.a.createElement(O.a,{title:"Seek back by ".concat(10," seconds")},i.a.createElement(d.a,{color:"primary",onClick:function(){if(te&&te.current){var t=te.current.currentTime-10;te.current.currentTime=t,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_seek_back",{fn:"handleSeekBack",newCurrentTimeInSeconds:t,seekBackValue:10})}},block:"true"},i.a.createElement(v.a,{color:"primary"})))),i.a.createElement(p.a,{item:!0},i.a.createElement(x.a,null,i.a.createElement(k.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:L,onChange:function(t){var a=L,n=t.target.value,r=parseFloat(n);te&&te.current&&(te.current.playbackRate=r,B(r),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_set_playback_rate",{fn:"handleSetPlaybackRate",previousPlaybackRate:a,newPlaybackRate:r}))}},ee.map((function(e,t){return i.a.createElement(f.a,{key:t+e,value:e}," ","x ",e)}))))))),i.a.createElement(p.a,{item:!0,style:{width:"100%"}},i.a.createElement(y.a,{size:"sm",className:"mb-3"},i.a.createElement(y.a.Prepend,null,i.a.createElement(y.a.Text,{id:"inputGroup-sizing-sm"},"Link at time")),i.a.createElement(h.a,{"aria-label":"Share URL @ time","aria-describedby":"inputGroup-sizing-sm",readOnly:!0,value:function(e){var t=new URL(window.location.toString());return t.search="","".concat(t.toString(),"?ts=").concat(e)}(o)}))),i.a.createElement(p.a,{item:!0},i.a.createElement(g.a,{color:"inherit",onClick:function(){xe(!fe)}},i.a.createElement(b.a,{variant:"subtitle2",gutterBottom:!0},"Speakers")),i.a.createElement(j.a,{in:fe},ue.map((function(e,t){return i.a.createElement(b.a,{variant:"body2",gutterBottom:!0,key:t+e,className:"text-truncate",title:e.toUpperCase()},e)}))))),i.a.createElement(p.a,{item:!0},e.children))),i.a.createElement(p.a,{item:!0,xs:12,sm:7,md:7,lg:7,xl:7},0!==z.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(E.a,{elevation:3},i.a.createElement("section",{className:"editor-wrapper-container"},i.a.createElement(_.c,{editor:R,value:z,onChange:function(t){return e.handleAutoSaveChanges&&(e.handleAutoSaveChanges(t),Ie(!0)),J(t)}},i.a.createElement(_.a,{readOnly:!1,renderElement:Je,renderLeaf:Me,onKeyDown:function(t){var a;return r.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(Be){n.next=3;break}return t.preventDefault(),n.abrupt("return");case 3:_e(!0),Ie(!1),"Enter"===t.key&&(t.preventDefault(),a=$.a.handleSplitParagraph(R),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_split_paragraph",{fn:"handleSplitParagraph",isSuccess:a}),a&&_e(!1)),"Backspace"===t.key&&$.a.handleDeleteInParagraph({editor:R,event:t})&&_e(!1),we&&te&&te.current&&!te.current.paused&&(te.current.pause(),ae(te.current));case 8:case"end":return n.stop()}}))}}))))):i.a.createElement("section",{className:"text-center"},"Loading"===e.status&&i.a.createElement("i",{className:"text-center"},"Loading...")||i.a.createElement("i",{className:"text-center"},"Pick a workshop to get started..."))),i.a.createElement(p.a,{item:!0,xs:12,sm:1,md:1,lg:1,xl:1},i.a.createElement(G,{handleExport:function(t){var a,n,c,l,i,o,s,m,d,u;return r.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(a=t.type,n=t.ext,c=t.speakers,l=t.timecodes,i=t.inlineTimecodes,o=t.hideTitle,s=t.atlasFormat,m=t.isDownload,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_export",{fn:"handleExport",type:a,ext:n,speakers:c,timecodes:l,inlineTimecodes:i,hideTitle:o,atlasFormat:s,isDownload:m}),p.prev=2,Te(!0),d=z,!l){p.next=9;break}return p.next=8,r.a.awrap(Xe());case 8:d=p.sent;case 9:if(!i){p.next=13;break}return p.next=12,r.a.awrap(Xe(i));case 12:d=p.sent;case 13:if(!De||"json-slate"!==a){p.next=17;break}return p.next=16,r.a.awrap(Xe());case 16:d=p.sent;case 17:if(!De||"json-digitalpaperedit"!==a){p.next=21;break}return p.next=20,r.a.awrap(Xe());case 20:d=p.sent;case 21:if(!De||!Object(Q.b)(a)){p.next=25;break}return p.next=24,r.a.awrap(Xe());case 24:d=p.sent;case 25:return u=Object(Q.a)({slateValue:d,type:a,transcriptTitle:We(),speakers:c,timecodes:l,inlineTimecodes:i,hideTitle:o,atlasFormat:s}),"json"===n&&(u=JSON.stringify(u,null,2)),"docx"!==n&&m&&Object(H.a)(u,"".concat(We(),".").concat(n)),p.abrupt("return",u);case 29:return p.prev=29,Te(!1),p.finish(29);case 32:case"end":return p.stop()}}),null,null,[[2,,29,32]])},isEditable:Be,handleSetEditable:function(){Re(!Be)},isProcessing:Oe,isContentModified:De,isContentSaved:Pe,setIsProcessing:Te,optionalBtns:e.optionalBtns})))))}t.default=ne;ne.defaultProps={showTitle:!1,showTimecodes:!0,showSpeakers:!0,autoSaveContentType:"digitalpaperedit",isEditable:!0}}}]);
//# sourceMappingURL=6.6149eb97.chunk.js.map