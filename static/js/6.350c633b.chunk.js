(this["webpackJsonp@pietrop/digital-paper-edit-client"]=this["webpackJsonp@pietrop/digital-paper-edit-client"]||[]).push([[6],{243:function(e,t,a){"use strict";a.r(t);var n=a(79),r=a.n(n),c=a(76),l=a(0),o=a.n(l),i=a(107),s=a.n(i),m=a(234),d=a(229),u=a(235),p=a(226),E=a(230),b=a(232),f=a(242),x=a(236),k=a(238),y=a(231),h=a(201),w=a.n(h),j=a(237),g=a(241),v=a(114),O=a.n(v),T=a(72),C=a(205),S=a(200),D=a(233),_=a(204),N=a(157),A=a.n(N),I=a(159),F=a.n(I),W=a(117);var B=function(e){var t=e.handleExport,a=e.optionalBtns,n=Object(l.useState)(null),r=Object(c.a)(n,2),i=r[0],s=r[1],m=function(){s(null)};return o.a.createElement(p.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},o.a.createElement("div",null,o.a.createElement(g.a,{title:"Export options"},o.a.createElement(d.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){s(e.currentTarget)}},o.a.createElement(A.a,{color:"primary"})," ",o.a.createElement(F.a,{color:"primary"}))),o.a.createElement(_.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:m},o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(y.a,{style:{color:"black"}},"Text Export")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"Text (",o.a.createElement("code",null,".txt"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"Text (Speakers)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!1,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"Text (Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Text (Speakers & Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"text",ext:"txt",speakers:!0,timecodes:!0,atlasFormat:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Text (Atlas format)")),o.a.createElement(D.a,null),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," ","Word (",o.a.createElement("code",null,".docx"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!1,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (Speakers)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (Speakers & Timecodes)")),o.a.createElement(f.a,{onClick:function(){t({type:"word",ext:"docx",speakers:!1,timecodes:!1,inlineTimecodes:!0,hideTitle:!0}),m()}},o.a.createElement(y.a,{color:"primary"}," Word (OHMS)")),o.a.createElement(D.a,null),o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(y.a,{style:{color:"black"}},"Closed Captions Export")),W.a.map((function(e,a){var n=e.type,r=e.label,c=e.ext;return o.a.createElement(f.a,{key:a+r,onClick:function(){t({type:n,ext:c,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},r," (",o.a.createElement("code",null,".",c),")"))})),o.a.createElement(D.a,null),o.a.createElement(f.a,{onClick:m,disabled:!0},o.a.createElement(y.a,{style:{color:"black"}},"Developer options")),o.a.createElement(f.a,{onClick:function(){t({type:"json-slate",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"SlateJs (",o.a.createElement("code",null,".json"),")")),o.a.createElement(f.a,{onClick:function(){t({type:"json-digitalpaperedit",ext:"json",speakers:!0,timecodes:!0,isDownload:!0}),m()}},o.a.createElement(y.a,{color:"primary"},"DPE (",o.a.createElement("code",null,".json"),")")))),a)},P=a(78),R=a(160),L=a(207),J=a(161),M=a(162),U=(a(163),a(90)),z=a(203),V=a(89),H=a(202),X=[.2,.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,3,3.5],q=o.a.createRef();O()((function(e){e.play()}),1500);function G(e){var t=this,a=Object(l.useState)(0),n=Object(c.a)(a,2),i=n[0],h=n[1],v=Object(l.useState)(0),O=Object(c.a)(v,2),D=O[0],_=O[1],N=Object(l.useState)(1),A=Object(c.a)(N,2),I=A[0],F=A[1],W=Object(l.useMemo)((function(){return Object(C.d)(Object(S.a)(Object(T.i)()))}),[]),G=Object(l.useState)([]),K=Object(c.a)(G,2),Q=K[0],Y=K[1],Z="boolean"!==typeof e.showSpeakers||e.showSpeakers,$="boolean"!==typeof e.showTimecodes||e.showTimecodes,ee=Object(l.useState)(Z),te=Object(c.a)(ee,2),ae=te[0],ne=(te[1],Object(l.useState)($)),re=Object(c.a)(ne,2),ce=re[0],le=(re[1],Object(l.useState)([])),oe=Object(c.a)(le,2),ie=oe[0],se=oe[1],me=Object(l.useState)(!1),de=Object(c.a)(me,2),ue=de[0],pe=de[1],Ee=Object(l.useState)(null),be=Object(c.a)(Ee,2),fe=(be[0],be[1],Object(l.useState)(!1)),xe=Object(c.a)(fe,2),ke=(xe[0],xe[1],Object(l.useState)(!1)),ye=Object(c.a)(ke,2),he=ye[0],we=ye[1],je=Object(l.useState)(!1),ge=Object(c.a)(je,2),ve=ge[0],Oe=ge[1],Te=Object(l.useState)(!0),Ce=Object(c.a)(Te,2),Se=Ce[0],De=Ce[1];Object(l.useEffect)((function(){document.body.style.cursor=he?"wait":"default"}),[he]),Object(l.useEffect)((function(){if(e.transcriptData){var t=Object(L.a)(e.transcriptData);Y(t)}}),[e.transcriptData]),Object(l.useEffect)((function(){var e=Object(M.a)("speaker")(Q);se(e)}),[Q]),Object(l.useEffect)((function(){return q&&q.current&&q.current.addEventListener("timeupdate",Ne),function(){q.current.removeEventListener("timeupdate",Ne)}}),[]),Object(l.useEffect)((function(){}),[i]);var _e=function(){return e.title?e.title:s.a.basename(e.mediaUrl).trim()},Ne=function(e){h(e.target.currentTime),_(q.current.duration)},Ae=Object(l.useCallback)((function(e){switch(e.element.type){case"timedText":return o.a.createElement(We,e);default:return o.a.createElement(Be,e)}}),[]),Ie=Object(l.useCallback)((function(e){var t=e.attributes,a=e.children;e.leaf;return o.a.createElement("span",Object.assign({onDoubleClick:Pe,className:"timecode text","data-start":a.props.parent.start,"data-previous-timings":a.props.parent.previousTimings},t),a)}),[]),Fe=function(e){C.b.findPath(W,e),e.speaker},We=function(e){var a=12,n=12;return ae||ce?ae&&!ce?(a=9,n=9):!ae&&ce?(a=9,n=10):ae&&ce&&(a=6,n=7):(a=12,n=12),o.a.createElement(p.a,Object.assign({container:!0,direction:"row",justify:"flex-start",alignItems:"flex-start"},e.attributes),ce&&o.a.createElement(p.a,{item:!0,contentEditable:!1,xs:4,sm:2,md:4,lg:2,xl:2,className:"p-t-2 text-truncate"},o.a.createElement("code",{contentEditable:!1,style:{cursor:"pointer"},className:"timecode text-muted unselectable",onClick:Pe,onDoubleClick:Pe,title:e.element.startTimecode,"data-start":e.element.start},e.element.startTimecode)),ae&&o.a.createElement(p.a,{item:!0,contentEditable:!1,xs:8,sm:10,md:8,lg:3,xl:3,className:"p-t-2 text-truncate"},o.a.createElement(b.a,{noWrap:!0,contentEditable:!1,className:"text-truncate text-muted unselectable",style:{cursor:"pointer",width:"100%",textTransform:"uppercase"},title:e.element.speaker,onClick:Fe.bind(t,e.element)},e.element.speaker)),o.a.createElement(p.a,{item:!0,xs:12,sm:12,md:12,lg:a,xl:n,className:"p-b-1 mx-auto"},e.children))},Be=function(e){return o.a.createElement("p",e.attributes,e.children)},Pe=function(t){if(t.target.classList.contains("timecode")){var a=t.target.dataset.start;q&&q.current&&(q.current.currentTime=parseFloat(a),q.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"timecode",timeInSeconds:q.current.currentTime}))}else if(t.target.dataset.slateString&&t.target.parentNode.dataset.start){var n=H.a.getSelectionNodes(W,W.selection).startWord;if(q&&q.current&&n&&n.start)q.current.currentTime=parseFloat(n.start),q.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",clickOrigin:"word",timeInSeconds:q.current.currentTime});else{var r=parseFloat(t.target.parentNode.dataset.start);q&&q.current&&r&&(q.current.currentTime=parseFloat(r),q.current.play(),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_timed_text_click",{fn:"handleTimedTextClick",origin:"paragraph-fallback",timeInSeconds:q.current.currentTime}))}}},Re=function(){var e,t,a,n=arguments;return r.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(e=n.length>0&&void 0!==n[0]&&n[0],ve||e){c.next=3;break}return c.abrupt("return",Q);case 3:return c.next=5,r.a.awrap(Object(U.b)(Q,e));case 5:if(t=c.sent,Y(t),Oe(!1),!e){c.next=11;break}return a=Object(J.a)(t),c.abrupt("return",a);case 11:return c.abrupt("return",t);case 12:case"end":return c.stop()}}))};return o.a.createElement("div",{style:{paddingTop:"1em"}},o.a.createElement(m.a,null),o.a.createElement(u.a,null,o.a.createElement(E.a,{elevation:3}),o.a.createElement("style",{scoped:!0},'/* Next words */\n             .timecode[data-previous-timings*="'.concat(Object(V.a)(i),"\"]{\n                  color:  #9E9E9E;\n              }\n              // NOTE: The CSS is here, coz if you put it as a separate index.css the current webpack does not bundle it with the component\n              /* TODO: Temporary, need to scope this to the component in a sensible way */\n              .editor-wrapper-container {\n                font-family: Roboto, sans-serif;\n              }\n              .editor-wrapper-container {\n                padding: 8px 16px;\n                height: 90vh;\n                overflow: auto;\n              }\n              /* https://developer.mozilla.org/en-US/docs/Web/CSS/user-select\n              TODO: only working in Chrome, not working in Firefox, and Safari - OSX\n              if selecting text, not showing selection\n              Commented out because it means cannot select speakers and timecode anymore\n              which is the intended default behavior but needs to come with export\n              functionality to export as plain text, word etc.. otherwise user won't be able\n              to get text out of component with timecodes and speaker names in the interim */\n              .unselectable {\n                -moz-user-select: none;\n                -webkit-user-select: none;\n                -ms-user-select: none;\n                user-select: none;\n              }\n              .timecode:hover {\n                text-decoration: underline;\n              }\n              .timecode.text:hover {\n                text-decoration: none;\n              }\n          ")),e.showTitle&&o.a.createElement(g.a,{title:e.title},o.a.createElement(b.a,{variant:"h5",noWrap:!0},e.title)),o.a.createElement(p.a,{container:!0,direction:"row",justify:"space-around",alignItems:"flex-start",spacing:2},o.a.createElement(p.a,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4},o.a.createElement(p.a,{container:!0,direction:"column",justify:"space-between",alignItems:"flex-start"},o.a.createElement(p.a,{item:!0,style:{backgroundColor:"black"}},o.a.createElement("video",{ref:q,src:e.mediaUrl,width:"100%",height:"auto",controls:!0,playsInline:!0})),o.a.createElement(p.a,{item:!0},o.a.createElement(p.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",spacing:1},o.a.createElement(p.a,{item:!0},o.a.createElement("p",null,o.a.createElement("code",{style:{color:"grey"}},Object(P.a)(i)),o.a.createElement("span",{style:{color:"grey"}}," "," | "),o.a.createElement("code",{style:{color:"grey"}},D?"".concat(Object(P.a)(D)):"00:00:00"))),o.a.createElement(p.a,{item:!0},o.a.createElement(g.a,{title:"Seek back by ".concat(10," seconds")},o.a.createElement(d.a,{color:"primary",onClick:function(){if(q&&q.current){var t=q.current.currentTime-10;q.current.currentTime=t,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_seek_back",{fn:"handleSeekBack",newCurrentTimeInSeconds:t,seekBackValue:10})}},block:"true"},o.a.createElement(w.a,{color:"primary"})))),o.a.createElement(p.a,{item:!0},o.a.createElement(x.a,null,o.a.createElement(k.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:I,onChange:function(t){var a=I,n=t.target.value,r=parseFloat(n);q&&q.current&&(q.current.playbackRate=r,F(r),e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_set_playback_rate",{fn:"handleSetPlaybackRate",previousPlaybackRate:a,newPlaybackRate:r}))}},X.map((function(e,t){return o.a.createElement(f.a,{key:t+e,value:e}," ","x ",e)}))))))),o.a.createElement(p.a,{item:!0},o.a.createElement(y.a,{color:"inherit",onClick:function(){pe(!ue)}},o.a.createElement(b.a,{variant:"subtitle2",gutterBottom:!0},"Speakers")),o.a.createElement(j.a,{in:ue},ie.map((function(e,t){return o.a.createElement(b.a,{variant:"body2",gutterBottom:!0,key:t+e,className:"text-truncate",title:e.toUpperCase()},e)})))),o.a.createElement(p.a,{item:!0},e.children))),o.a.createElement(p.a,{item:!0,xs:12,sm:7,md:7,lg:7,xl:7},0!==Q.length?o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{elevation:3},o.a.createElement("section",{className:"editor-wrapper-container"},o.a.createElement(C.c,{editor:W,value:Q,onChange:function(t){return e.handleAutoSaveChanges&&(e.handleAutoSaveChanges(t),De(!0)),Y(t)}},o.a.createElement(C.a,{readOnly:"boolean"===typeof e.isEditable&&!e.isEditable,renderElement:Ae,renderLeaf:Ie}))))):o.a.createElement("section",{className:"text-center"},o.a.createElement("i",{className:"text-center"},"Loading..."))),o.a.createElement(p.a,{item:!0,xs:12,sm:1,md:1,lg:1,xl:1},o.a.createElement(B,{handleExport:function(t){var a,n,c,l,o,i,s,m,d,u;return r.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(a=t.type,n=t.ext,c=t.speakers,l=t.timecodes,o=t.inlineTimecodes,i=t.hideTitle,s=t.atlasFormat,m=t.isDownload,e.handleAnalyticsEvents&&e.handleAnalyticsEvents("ste_handle_export",{fn:"handleExport",type:a,ext:n,speakers:c,timecodes:l,inlineTimecodes:o,hideTitle:i,atlasFormat:s,isDownload:m}),p.prev=2,we(!0),d=Q,!l){p.next=9;break}return p.next=8,r.a.awrap(Re());case 8:d=p.sent;case 9:if(!o){p.next=13;break}return p.next=12,r.a.awrap(Re(o));case 12:d=p.sent;case 13:if(!ve||"json-slate"!==a){p.next=17;break}return p.next=16,r.a.awrap(Re());case 16:d=p.sent;case 17:if(!ve||"json-digitalpaperedit"!==a){p.next=21;break}return p.next=20,r.a.awrap(Re());case 20:d=p.sent;case 21:if(!ve||!Object(z.b)(a)){p.next=25;break}return p.next=24,r.a.awrap(Re());case 24:d=p.sent;case 25:return u=Object(z.a)({slateValue:d,type:a,transcriptTitle:_e(),speakers:c,timecodes:l,inlineTimecodes:o,hideTitle:i,atlasFormat:s}),"json"===n&&(u=JSON.stringify(u,null,2)),"docx"!==n&&m&&Object(R.a)(u,"".concat(_e(),".").concat(n)),p.abrupt("return",u);case 29:return p.prev=29,we(!1),p.finish(29);case 32:case"end":return p.stop()}}),null,null,[[2,,29,32]])},isProcessing:he,isContentModified:ve,isContentSaved:Se,setIsProcessing:we,optionalBtns:e.optionalBtns})))))}t.default=G;G.defaultProps={showTitle:!1,showTimecodes:!0,showSpeakers:!0,autoSaveContentType:"digitalpaperedit",isEditable:!0}}}]);
//# sourceMappingURL=6.350c633b.chunk.js.map